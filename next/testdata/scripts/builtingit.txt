mkhomedir golden
[!windows] chmod 755 golden/git
mkhomedir

# install fake git
cp golden/git golden/git.cmd bin

! chezmoi init
chezmoi init --use-builtin-git
exists $CHEZMOISOURCEDIR/.git

[short] stop

# create a commit
rm bin/git bin/git.cmd # disable fake git
[!exec:git] stop
cp golden/.bashrc $CHEZMOISOURCEDIR/dot_bashrc
chezmoi git add dot_bashrc
chezmoi git commit -- --message 'Add dot_bashrc'
cp golden/git golden/git.cmd bin # restore fake git

# test chezmoi init --use-builtin-git
chhome home2/user
! chezmoi init file://$WORK/home/user/.local/share/chezmoi
chezmoi init --use-builtin-git file://$WORK/home/user/.local/share/chezmoi
exists $CHEZMOISOURCEDIR/.git
cmp $CHEZMOISOURCEDIR/dot_bashrc golden/.bashrc

# create a second commit
chhome home/user
rm bin/git bin/git.cmd # disable fake git
cp golden/.binary $CHEZMOISOURCEDIR/executable_dot_binary
chezmoi git add executable_dot_binary
chezmoi git commit -- --message 'Add executable_dot_binary'
cp golden/git golden/git.cmd bin # restore fake git

# test chezmoi update --use-builtin-git
chhome home2/user
! chezmoi update
chezmoi update --use-builtin-git
cmp $CHEZMOISOURCEDIR/executable_dot_binary golden/.binary

-- golden/git --
#!/bin/sh

exit 1
-- golden/git.cmd --
@echo off
exit /b 1
